
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://SalvadorVelaSanz.github.io/Practica8/">
      
      
        <link rel="prev" href="../Practica7/">
      
      
        <link rel="next" href="../PracticaAmpliacion/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>Practica3.3 - My site</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#procedimiento-completo-para-el-despliegue" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="My site" class="md-header__button md-logo" aria-label="My site" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My site
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Practica3.3
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="My site" class="md-nav__button md-logo" aria-label="My site" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    My site
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica2.1
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Practica2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica2.2
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Practica3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica2.3
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Practica4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica2.4
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Practica5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica2.5
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Practica6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica3.1
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Practica7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica3.2
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Practica3.3
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Practica3.3
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#instalacion-de-pip" class="md-nav__link">
    <span class="md-ellipsis">
      Instalación de pip
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instalacion-de-pipenv" class="md-nav__link">
    <span class="md-ellipsis">
      Instalación de pipenv
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-del-directorio-del-proyecto" class="md-nav__link">
    <span class="md-ellipsis">
      Creación del directorio del proyecto
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-del-archivo-env" class="md-nav__link">
    <span class="md-ellipsis">
      Creación del archivo .env
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iniciar-el-entorno-virtual" class="md-nav__link">
    <span class="md-ellipsis">
      Iniciar el entorno virtual
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instalacion-de-dependencias" class="md-nav__link">
    <span class="md-ellipsis">
      Instalación de dependencias
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-de-la-aplicacion-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Creación de la aplicación Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comprobacion-de-la-aplicacion-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Comprobación de la aplicación Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comprobacion-de-gunicorn" class="md-nav__link">
    <span class="md-ellipsis">
      Comprobación de Gunicorn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iniciar-nginx" class="md-nav__link">
    <span class="md-ellipsis">
      Iniciar Nginx
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-del-servicio-systemd" class="md-nav__link">
    <span class="md-ellipsis">
      Creación del servicio systemd
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-de-nginx" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración de Nginx
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cuestiones" class="md-nav__link">
    <span class="md-ellipsis">
      Cuestiones
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cuestiones">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cuestion-1" class="md-nav__link">
    <span class="md-ellipsis">
      Cuestion 1
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../PracticaAmpliacion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PracticaAmpliacion
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Practica9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica4.1
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Practica10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica5.1
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Practica11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica6.1
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Practica12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica6.2
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Practica13/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Practica6.3
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#instalacion-de-pip" class="md-nav__link">
    <span class="md-ellipsis">
      Instalación de pip
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instalacion-de-pipenv" class="md-nav__link">
    <span class="md-ellipsis">
      Instalación de pipenv
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-del-directorio-del-proyecto" class="md-nav__link">
    <span class="md-ellipsis">
      Creación del directorio del proyecto
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-del-archivo-env" class="md-nav__link">
    <span class="md-ellipsis">
      Creación del archivo .env
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iniciar-el-entorno-virtual" class="md-nav__link">
    <span class="md-ellipsis">
      Iniciar el entorno virtual
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instalacion-de-dependencias" class="md-nav__link">
    <span class="md-ellipsis">
      Instalación de dependencias
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-de-la-aplicacion-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Creación de la aplicación Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comprobacion-de-la-aplicacion-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Comprobación de la aplicación Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comprobacion-de-gunicorn" class="md-nav__link">
    <span class="md-ellipsis">
      Comprobación de Gunicorn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iniciar-nginx" class="md-nav__link">
    <span class="md-ellipsis">
      Iniciar Nginx
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creacion-del-servicio-systemd" class="md-nav__link">
    <span class="md-ellipsis">
      Creación del servicio systemd
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-de-nginx" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración de Nginx
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cuestiones" class="md-nav__link">
    <span class="md-ellipsis">
      Cuestiones
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cuestiones">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cuestion-1" class="md-nav__link">
    <span class="md-ellipsis">
      Cuestion 1
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="procedimiento-completo-para-el-despliegue">Procedimiento completo para el despliegue</h1>
<h2 id="instalacion-de-pip">Instalación de pip</h2>
<p>Instalamos el gestor de paquetes de Python pip:</p>
<pre><code class="language-bash">sudo apt update
sudo apt install python3-pip
</code></pre>
<p><img alt="Captura 1" src="../images/Practica3.3/1.png" /></p>
<h2 id="instalacion-de-pipenv">Instalación de pipenv</h2>
<p>Instalamos el paquete pipenv para gestionar los entornos virtuales:</p>
<pre><code class="language-bash">sudo apt install pipenv
</code></pre>
<p><img alt="Captura 2" src="../images/Practica3.3/2.png" /></p>
<p>Y comprobamos que está instalado correctamente mostrando su versión:</p>
<pre><code class="language-bash">pipenv --version
</code></pre>
<p><img alt="Captura 3" src="../images/Practica3.3/3.png" /></p>
<h2 id="creacion-del-directorio-del-proyecto">Creación del directorio del proyecto</h2>
<p>Creamos el directorio en el que almacenaremos nuestro proyecto:</p>
<pre><code class="language-bash">sudo mkdir /var/www/nombre_mi_aplicacion
</code></pre>
<p>Al crearlo con <code>sudo</code>, los permisos pertenecen a root. Hay que cambiarlo para que el dueño sea nuestro usuario (raul-debian en mi caso) y pertenezca al grupo <code>www-data</code>, el usuario usado por defecto por el servidor web para correr:</p>
<pre><code class="language-bash">sudo chown -R $USER:www-data /var/www/mi_aplicacion
</code></pre>
<p>Establecemos los permisos adecuados a este directorio, para que pueda ser leído por todo el mundo:</p>
<pre><code class="language-bash">chmod -R 775 /var/www/mi_aplicacion
</code></pre>
<p><img alt="Captura 4" src="../images/Practica3.3/4.png" /></p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Es indispensable asignar estos permisos, de otra forma obtendríamos un error al acceder a la aplicación cuando pongamos en marcha Nginx.</p>
</blockquote>
<h2 id="creacion-del-archivo-env">Creación del archivo .env</h2>
<p>Dentro del directorio de nuestra aplicación, creamos un archivo oculto <code>.env</code> que contendrá las variables de entorno necesarias:</p>
<pre><code class="language-bash">touch .env
</code></pre>
<p><img alt="Captura 5" src="../images/Practica3.3/5.png" /></p>
<p>Editamos el archivo y añadimos las variables, indicando cuál es el archivo <code>.py</code> de la aplicación y el entorno, que en nuestro caso será producción.
<img alt="Captura 6" src="../images/Practica3.3/6.png" /></p>
<blockquote>
<p><strong>Nota</strong></p>
<p>En el mundo laboral real, se supone que la aplicación previamente ha pasado por los entornos de dev, test y preprod para el desarrollo y prueba de la misma, antes de pasarla a producción.</p>
</blockquote>
<h2 id="iniciar-el-entorno-virtual">Iniciar el entorno virtual</h2>
<p>Iniciamos ahora nuestro entorno virtual. Pipenv cargará las variables de entorno desde el fichero <code>.env</code> de forma automática:</p>
<pre><code class="language-bash">pipenv shell
</code></pre>
<p><img alt="Captura 7" src="../images/Practica3.3/7.png" /></p>
<p>Veremos que se nos inicia el entorno virtual, cosa que comprobamos porque aparece su nombre al inicio del prompt del shell.</p>
<h2 id="instalacion-de-dependencias">Instalación de dependencias</h2>
<p>Usamos pipenv para instalar las dependencias necesarias para nuestro proyecto:</p>
<pre><code class="language-bash">pipenv install flask gunicorn
</code></pre>
<p><img alt="Captura 8" src="../images/Practica3.3/8.png" /></p>
<h2 id="creacion-de-la-aplicacion-flask">Creación de la aplicación Flask</h2>
<p>Vamos ahora a crear la aplicación Flask más simple posible, a modo de PoC (proof of concept o prueba de concepto). El archivo que contendrá la aplicación propiamente dicha será <code>application.py</code> y <code>wsgi.py</code> se encargará únicamente de iniciarla y dejarla corriendo:</p>
<pre><code class="language-bash">touch application.py wsgi.py
</code></pre>
<p>Y tras crear los archivos, los editamos para dejarlos así.
<img alt="Captura 9" src="../images/Practica3.3/9.png" /></p>
<h2 id="comprobacion-de-la-aplicacion-flask">Comprobación de la aplicación Flask</h2>
<p>Corramos ahora nuestra aplicación a modo de comprobación con el servidor web integrado de Flask. Si especificamos la dirección <code>0.0.0.0</code> lo que le estamos diciendo al servidor es que escuche en todas sus interfaces, si las tuviera.</p>
<p>Ahora podremos acceder a la aplicación desde nuestro ordenador, nuestra máquina anfitrión, introduciendo en un navegador web: <code>http://IP-maq-virtual:5000</code>.</p>
<p>Tras la comprobación, paramos el servidor con <code>CTRL+C</code>.</p>
<p><img alt="Captura 10" src="../images/Practica3.3/10.png" />
<img alt="Captura 11" src="../images/Practica3.3/11.png" /></p>
<blockquote>
<p><strong>Recordatorio</strong></p>
<p>Habrás de abrir el puerto correspondiente en el grupo de seguridad.</p>
</blockquote>
<h2 id="comprobacion-de-gunicorn">Comprobación de Gunicorn</h2>
<p>Comprobemos ahora que Gunicorn funciona correctamente también. Si os ha funcionado el servidor de desarrollo de Flask, podéis usar el siguiente comando para probar que la aplicación funciona correctamente usando Gunicorn, accediendo con vuestro navegador de la misma forma que en el paso anterior:</p>
<pre><code class="language-bash">gunicorn --workers 4 --bind 0.0.0.0:5000 wsgi:app
</code></pre>
<p>Donde:
- <code>--workers N</code> establece el número de workers o hilos que queremos utilizar, como ocurría con Node Express. Dependerá del número de cores que le hayamos dado a la CPU de nuestra máquina virtual.
- <code>--bind 0.0.0.0:5000</code> hace que el servidor escuche peticiones por todas sus interfaces de red y en el puerto 5000.
- <code>wsgi:app</code> es el nombre del archivo con extensión <code>.py</code> y <code>app</code> es la instancia de la aplicación Flask dentro del archivo.</p>
<p><img alt="Captura 12" src="../images/Practica3.3/12.png" /></p>
<p>Todavía dentro de nuestro entorno virtual, debemos tomar nota de cuál es el path o ruta desde la que se ejecuta gunicorn para poder configurar más adelante un servicio del sistema. Podemos averiguarlo así:
<img alt="Captura 13" src="../images/Practica3.3/13.png" /></p>
<blockquote>
<p><strong>Tip</strong></p>
<p>Y tras ello debemos salir de nuestro entorno virtual con el sencillo comando <code>deactivate</code>.</p>
</blockquote>
<p><img alt="Captura 14" src="../images/Practica3.3/14.png" /></p>
<h2 id="iniciar-nginx">Iniciar Nginx</h2>
<p>Puesto que ya debemos tener instalado Nginx en nuestro sistema, lo iniciamos y comprobamos que su estado sea activo:</p>
<pre><code class="language-bash">sudo systemctl start nginx
sudo systemctl status nginx
</code></pre>
<p><img alt="Captura 15" src="../images/Practica3.3/15.png" /></p>
<h2 id="creacion-del-servicio-systemd">Creación del servicio systemd</h2>
<p>Ya fuera de nuestro entorno virtual, crearemos un archivo para que systemd corra Gunicorn como un servicio del sistema más.</p>
<p>Donde:
- <code>User</code>: Establece el usuario que tiene permisos sobre el directorio del proyecto (el que pusistéis en el paso 5).
- <code>Group</code>: Establece el grupo que tiene permisos sobre el directorio del proyecto (el que pusistéis en el paso 5).
- <code>Environment</code>: Establece el directorio bin (donde se guardan los binarios ejecutables) dentro del entorno virtual (lo visteis en el paso 14).
- <code>WorkingDirectory</code>: Establece el directorio base donde reside nuestro proyecto.
- <code>ExecStart</code>: Establece el path donde se encuentra el ejecutable de gunicorn dentro del entorno virtual, así como las opciones y comandos con los que se iniciará.</p>
<p><img alt="Captura 16" src="../images/Practica3.3/16.png" /></p>
<blockquote>
<p><strong>Warning</strong></p>
<p>Debéis cambiar los valores para que coincidan con los de vuestro caso particular.</p>
</blockquote>
<p>Ahora, como cada vez que se crea un servicio nuevo de systemd, se habilita y se inicia:</p>
<pre><code class="language-bash">systemctl enable nombre_mi_servicio
systemctl start nombre_mi_servicio
</code></pre>
<p><img alt="Captura 17" src="../images/Practica3.3/17.png" /></p>
<p>Recordad que el nombre del servicio es el nombre del archivo que creasteis en el paso anterior.</p>
<h2 id="configuracion-de-nginx">Configuración de Nginx</h2>
<p>Pasemos ahora a configurar Nginx, que es algo que ya deberíamos tener dominado de capítulos anteriores.</p>
<p>Creamos un archivo con el nombre de nuestra aplicación y dentro estableceremos la configuración para ese sitio web. El archivo, como recordáis, debe estar en <code>/etc/nginx/sites-available/nombre_aplicacion</code> y tras ello lo editamos para que quede:</p>
<pre><code class="language-nginx">server {
    listen 80;
    server_name mi_aplicacion www.mi_aplicacion;

    access_log /var/log/nginx/mi_aplicacion.access.log;
    error_log /var/log/nginx/mi_aplicacion.error.log;

    location / { 
            include proxy_params;
            proxy_pass http://unix:/var/www/nombre_aplicacion/nombre_aplicacion.sock;
    }
}
</code></pre>
<p><img alt="Captura 18" src="../images/Practica3.3/18.png" /></p>
<p>Recordemos que ahora debemos crear un link simbólico del archivo de sitios webs disponibles al de sitios web activos:</p>
<pre><code class="language-bash">sudo ln -s /etc/nginx/sites-available/nombre_aplicacion /etc/nginx/sites-enabled/
</code></pre>
<p>Y nos aseguramos de que se ha creado dicho link simbólico:</p>
<pre><code class="language-bash">ls -l /etc/nginx/sites-enabled/ | grep nombre_aplicacion
</code></pre>
<p>Nos aseguramos de que la configuración de Nginx no contiene errores, reiniciamos Nginx y comprobamos que su estado es activo:</p>
<pre><code class="language-bash">nginx -t
sudo systemctl restart nginx
sudo systemctl status nginx
</code></pre>
<p><img alt="Captura 19" src="../images/Practica3.3/19.png" /></p>
<p>Ya no podremos acceder por IP a nuestra aplicación ya que ahora está siendo servida por Gunicorn y Nginx, necesitamos acceder por su <code>server_name</code>. Puesto que aún no hemos tratado con el DNS, vamos a editar el archivo <code>/etc/hosts</code> de nuestra máquina anfitriona para que asocie la IP de la máquina virtual, a nuestro <code>server_name</code>.</p>
<p>Este archivo, en Linux, está en: <code>/etc/hosts</code>.</p>
<p>Y en Windows: <code>C:\Windows\System32\drivers\etc\hosts</code>.</p>
<p>Y deberemos añadirle la línea:</p>
<pre><code>192.168.X.X myproject www.myproject
</code></pre>
<p>donde debéis sustituir la IP por la que tenga vuestra máquina virtual.</p>
<p><img alt="Captura 20" src="../images/Practica3.3/20.png" /></p>
<p>El último paso es comprobar que todo el desplieuge se ha realizado de forma correcta y está funcionando, para ello accedemos desde nuestra máquina anfitrión a:</p>
<p>http://nombre_aplicacion</p>
<p>O:</p>
<p>http://www.nombre_aplicacion</p>
<p>Y debería mostraros la misma página que en el paso 14:</p>
<p><img alt="Captura 21" src="../images/Practica3.3/21.png" /></p>
<h2 id="cuestiones">Cuestiones</h2>
<h3 id="cuestion-1">Cuestion 1</h3>
<p>Busca, lee, entiende y explica qué es y para que sirve un servidor WSGI</p>
<p>Un servidor WSGI (Web Server Gateway Interface) es una interfaz estándar que conecta aplicaciones web escritas en Python con servidores web como Apache o Nginx. Actúa como intermediario, recibiendo solicitudes HTTP del servidor y pasándolas a la aplicación Python para su procesamiento, y luego devolviendo las respuestas al cliente. Es esencial para ejecutar aplicaciones Python en producción, garantizando compatibilidad entre servidores y frameworks, además de ofrecer escalabilidad y eficiencia</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
    
  </body>
</html>